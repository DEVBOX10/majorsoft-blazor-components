<h1>Notifications</h1>
<PageScroll />

<p>
	Blazor <strong>injectable <code>INotificationService</code> service</strong> and components that renders customizable Alert and Toast notification message elements. For usage see source code and docs on
	<a href="https://github.com/majorimi/blazor-components/blob/master/.github/docs/Notifications.md" target="_blank">Github</a>.
	<br /><strong>Majorsoft.Blazor.Components.Notifications</strong> package is available on <a href="https://www.nuget.org/packages/Majorsoft.Blazor.Components.Notifications" target="_blank">Nuget</a>
</p>

<h3>Notification features:</h3>
<ul>
	<li><NavLink href="notifications#alerts">Alert</NavLink></li>
	<li><NavLink href="notifications#toasts">Toast</NavLink></li>
	<li><NavLink href="notifications#htmlnotification">Html5 Notification</NavLink></li>
</ul>

<div class="container-fluid p-3 mb-3 border rounded">
	<PermaLinkElement PermaLinkName="alerts" IconActions="PermaLinkIconActions.Copy|PermaLinkIconActions.Navigate" IconMarginTop="8" IconSize="18">
		<Content><h3>Alert</h3></Content>
	</PermaLinkElement>
	<p>
		Renders <strong><code>Alert</code> component </strong> which is a banner to show important system messages.
		Importance can be emphasized by <code>SeverityLevel</code> and styling with customizable content. Alerts can be closes automatically or let user close them, etc.
	</p>

	<h4>All styles</h4>
	<div class="row pb-2">
		@foreach (var style in Enum.GetValues<NotificationStyles>())
		{
			<div class="col-4">
				@foreach (var severity in Enum.GetValues<NotificationSeverityLevel>())
				{
					<Alert AutoClose="false" IsVisible="true"
						   NotificationStyle="style"
						   Severity="severity">
						<Content>
							Severity: <strong>@severity</strong> Alert style: <strong>@style</strong>
						</Content>
					</Alert>
				}
			</div>
		}
	</div>

	<h4>Customization</h4>

	<div class="w-100 mb-4">
		<Alert Severity="@_alertSeverityLevel"
			   NotificationStyle="@_alertStyle"
			   IsVisible="@_alertIsVisible"
			   AutoClose="@_alertAutoClose"
			   AutoCloseInSec="@_alertAutoCloseInSec"
			   ShowCloseButton="@_alertShowCloseButton"
			   ShowIcon="@_alertShowIcon"
			   ShadowEffect="@_shadowEffect"
			   ShowCloseCountdownProgress="@_alertShowCountdownProgress"
			   OnOpen="OnOpen"
			   OnClose="OnClose"
			   OnCloseButtonClicked="OnCloseButtonClicked">
			<Content>
				<strong>Alert:</strong> @_alertText
			</Content>
		</Alert>
	</div>

	<div class="row pb-2">
		<div class="col-12 col-lg-8 col-xl-5">
			Alert is Visible: <input class="mr-2" type="checkbox" @bind="_alertIsVisible" disabled="disabled" />
			Show Close button: <input class="mr-2" type="checkbox" @bind="_alertShowCloseButton" />
			Show icon: <input class="mr-2" type="checkbox" @bind="_alertShowIcon" />
			<br />
			Show Countdown Progress: <input class="mr-2" type="checkbox" @bind="_alertShowCountdownProgress" disabled="@_alertIsVisible" />
			Auto close (after @_alertAutoCloseInSec sec): <input class="mr-2" type="checkbox" @bind="_alertAutoClose" disabled="@_alertIsVisible" />
			<input type="range" class="w-100" min="1" max="20" @bind="_alertAutoCloseInSec" @oninput="(e => _alertAutoCloseInSec = uint.Parse(e.Value?.ToString()))" disabled="@_alertIsVisible" />
			Shadow (3D) effect: <input type="range" class="w-100" min="0" max="20" @bind="_shadowEffect" @oninput="(e => _shadowEffect = uint.Parse(e.Value?.ToString()))" />
		</div>
	</div>

	<div class="row pb-2">
		<div class="col-12 col-lg-8 col-xl-5">
			Message: <input class="form-control w-100" @bind="_alertText" />
		</div>
	</div>

	<div class="row pb-2">
		<div class="col-12 col-lg-8 col-xl-5">
			Alert style: <select class="form-control selectpicker w-100" @bind="_alertStyle">
				@foreach (var item in Enum.GetValues(typeof(NotificationStyles)))
				{
					<option value="@item">@item</option>
				}
			</select>
		</div>
	</div>
	<div class="row pb-2">
		<div class="col-12 col-lg-8 col-xl-5">
			Severity Level:
			<select class="form-control selectpicker w-100"
					@onchange="@(e => { _alertSeverityLevel = Enum.Parse<NotificationSeverityLevel>(e.Value?.ToString()); _alertText = $"This is a(n) {_alertSeverityLevel} alert..."; })">
				@foreach (var item in Enum.GetValues(typeof(NotificationSeverityLevel)))
				{
					<option value="@item">@item</option>
				}
			</select>

			<button class="btn btn-primary mt-2" disabled="@_alertIsVisible" @onclick="a => _alertIsVisible = !_alertIsVisible">Show Alert</button>
		</div>
	</div>

	<div class="row pb-2">
		<div class="col-12">
			<label><strong>Event log</strong>:</label>
			<textarea @ref="log1" @bind="_alertLog" style="height:200px;" class="form-control w-100" readonly></textarea>
		</div>
	</div>
</div>

<div class="container-fluid p-3 mb-3 border rounded">
	<PermaLinkElement PermaLinkName="toasts" IconActions="PermaLinkIconActions.Copy|PermaLinkIconActions.Navigate" IconMarginTop="8" IconSize="18">
		<Content><h3>Toast</h3></Content>
	</PermaLinkElement>
	<p>Renders <strong><code>CollapsePanel</code> component </strong> which is an <strong> Expandable and Collapsible panel</strong> with customizable header and content.</p>

</div>

<div class="container-fluid p-3 mb-3 border rounded">
	<PermaLinkElement PermaLinkName="htmlnotification" IconActions="PermaLinkIconActions.Copy|PermaLinkIconActions.Navigate" IconMarginTop="8" IconSize="18">
		<Content><h3>HTML5 Notification</h3></Content>
	</PermaLinkElement>
	<p>
		Injectable <strong><code>IHtmlNotificationService</code> service </strong> which is a <strong> wrapper for Notification API</strong>
		to handle <a href="https://developer.mozilla.org/en-US/docs/Web/API/notification" target="_blank">HTML5 notifications</a>.
	</p>

	<div class="row pb-2">
		<div class="col-12 col-lg-8 col-xl-5">
			HTML5 Notification supported:
			<strong class="mr-2 @(_notificationSupported ? "text-success" : "text-danger")">@_notificationSupported</strong>
			Notification user consent:
			<strong class="@(_htmlNotificationPermission == HtmlNotificationPermissionTypes.Denied ? "text-danger" : "text-success")">@_htmlNotificationPermission</strong>
		</div>
	</div>

	@if (_notificationSupported)
	{
		@if (_htmlNotificationPermission != HtmlNotificationPermissionTypes.Granted)
		{
			<button class="btn btn-primary mt-2" @onclick="RequestPermission">Request user Permission</button>
		}
		else
		{
			<div class="row pb-2">
				<div class="col-12 col-lg-8 col-xl-5">
					Notification Title: <input class="form-control w-100" @bind="_notificationTitle" />
				</div>
			</div>
			<div class="row pb-2">
				<div class="col-12 col-lg-8 col-xl-5">
					Notification Body: <input class="form-control w-100" @bind="_notificationBody" />
				</div>
			</div>
			<div class="row pb-2">
				<div class="col-12 col-lg-8 col-xl-5">
					Notification Icon: <input class="form-control w-100" @bind="_notificationIcon" />
				</div>
			</div>

			<button class="btn btn-primary mt-2" @onclick="Notification">Show notification</button>
		}
	}

</div>

@inject IHtmlNotificationService _notificationService
@implements IAsyncDisposable

@code { 
	protected override async Task OnAfterRenderAsync(bool firstRender)
	{
		if (firstRender)
		{
			_notificationSupported = await _notificationService.IsBrowserSupportedAsync();
			_htmlNotificationPermission = await _notificationService.CheckPermissionAsync();
			StateHasChanged();
		}
	}

	//Alert
	private bool _alertIsVisible = false;
	private bool _alertAutoClose = true;
	private bool _alertShowIcon = true;
	private bool _alertShowCloseButton = true;
	private bool _alertShowCountdownProgress = true;
	private uint _alertAutoCloseInSec = 5;
	private uint _shadowEffect = 0;
	private string _alertText = $"This is a(n) {nameof(NotificationSeverityLevel.Primary)} alert...";
	private NotificationSeverityLevel _alertSeverityLevel = NotificationSeverityLevel.Primary;
	private NotificationStyles _alertStyle = NotificationStyles.Normal;

	private ElementReference log1;
	private string _alertLog = "";

	//Alert events
	public async Task OnOpen()
	{
		_alertLog = await WriteLog(_alertLog, $"Alert event: '{nameof(OnOpen)}' Dialog opened.");
	}
	public async Task OnClose()
	{
		_alertIsVisible = false; //Or use two-way binding.
		_alertLog = await WriteLog(_alertLog, $"Alert event: '{nameof(OnClose)}' Dialog closed.");
	}
	private async Task OnCloseButtonClicked(MouseEventArgs e)
	{
		_alertLog = await WriteLog(_alertLog, $"Alert event: '{nameof(OnCloseButtonClicked)}', Event args: {e}.");
	}

	//Toast

	//HTML5 notification
	private bool _notificationSupported;
	private HtmlNotificationPermissionTypes _htmlNotificationPermission;
	private string _notificationTitle = "Notification Title";
	private string _notificationBody = "Notification Body";
	private string _notificationIcon = "https://www.google.com/favicon.ico";

	private async Task RequestPermission()
	{
		await _notificationService.RequestPermissionAsync(async res =>
		{
			_htmlNotificationPermission = res;
			StateHasChanged();
		});
	}
	private async Task Notification()
	{
		var options = new HtmlNotificationData(_notificationTitle)
		{
			Body = _notificationBody
		};

		var id = await _notificationService.ShowsAsync(options);
	}


	private async Task<string> WriteLog(string log, string message)
	{
		log += $"{DateTime.Now.TimeOfDay}: {message}. \r\n";
		await log1.ScrollToEndAsync();

		return log;
	}
	public async ValueTask DisposeAsync()
	{
		if(_notificationService is not null)
		{
			await _notificationService.DisposeAsync();
		}
	}
}